import type { RiskScore } from '../../api/types'
import { getLevelColor } from '../ui/Badge'

interface VulnOverviewProps {
  vuln: RiskScore
}

export default function VulnOverview({ vuln }: VulnOverviewProps) {
  const color = getLevelColor(vuln.risk_level)

  return (
    <div className="gf-tab-content">
      {/* Location card */}
      {vuln.where && (
        <div className="gf-ov-card">
          <div className="gf-ov-card-header">
            <span className="gf-ov-card-icon">&#128205;</span>
            <span className="gf-ov-card-title">Location</span>
          </div>
          <div className="gf-ov-card-body">
            <div className="gf-ov-row">
              <span className="gf-ov-label">Target URL</span>
              <span className="gf-ov-value mono gf-ov-url">{vuln.where.url}</span>
            </div>
            <div className="gf-ov-row">
              <span className="gf-ov-label">Parameter</span>
              <span className="gf-ov-value">
                <span className="gf-ov-param-badge">{vuln.where.parameter}</span>
              </span>
            </div>
            {vuln.where.method && (
              <div className="gf-ov-row">
                <span className="gf-ov-label">Method</span>
                <span className="gf-ov-value">
                  <span className="gf-ov-method-badge">{vuln.where.method}</span>
                </span>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Classification card */}
      {vuln.what && (
        <div className="gf-ov-card">
          <div className="gf-ov-card-header">
            <span className="gf-ov-card-icon">&#128300;</span>
            <span className="gf-ov-card-title">Classification</span>
          </div>
          <div className="gf-ov-card-body">
            <div className="gf-ov-type-row">
              <div className="gf-ov-type-main" style={{ borderLeftColor: color }}>
                <span className="gf-ov-type-name">{vuln.what.vulnerability_type}</span>
                {vuln.what.cwe_id && (
                  <span className="gf-ov-cwe-tag">{vuln.what.cwe_id}</span>
                )}
              </div>
            </div>

            {vuln.what.payload_used && (
              <div className="gf-ov-row">
                <span className="gf-ov-label">Payload</span>
                <span className="gf-ov-value">
                  <code className="gf-ov-code">{vuln.what.payload_used}</code>
                </span>
              </div>
            )}

            {vuln.what.evidence && (
              <div className="gf-ov-row">
                <span className="gf-ov-label">Evidence</span>
                <span className="gf-ov-value gf-ov-evidence">{vuln.what.evidence}</span>
              </div>
            )}

            {vuln.what.description && (
              <div className="gf-ov-desc">
                <span className="gf-ov-desc-icon">&#9432;</span>
                <span className="gf-ov-desc-text">{vuln.what.description}</span>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Quick metrics row */}
      <div className="gf-ov-metrics">
        <div className="gf-ov-metric" style={{ borderTopColor: color }}>
          <span className="gf-ov-metric-val" style={{ color }}>{vuln.risk_score}</span>
          <span className="gf-ov-metric-label">Risk Score</span>
        </div>
        <div className="gf-ov-metric" style={{ borderTopColor: color }}>
          <span className="gf-ov-metric-val" style={{ color }}>{vuln.risk_level}</span>
          <span className="gf-ov-metric-label">Severity</span>
        </div>
        <div className="gf-ov-metric" style={{ borderTopColor: 'var(--accent)' }}>
          <span className="gf-ov-metric-val">{vuln.remediation_priority}</span>
          <span className="gf-ov-metric-label">Priority</span>
        </div>
        <div className="gf-ov-metric" style={{ borderTopColor: vuln.has_exploit ? 'var(--critical)' : 'var(--low)' }}>
          <span className="gf-ov-metric-val" style={{ color: vuln.has_exploit ? 'var(--critical)' : 'var(--low)' }}>
            {vuln.has_exploit ? 'Yes' : 'No'}
          </span>
          <span className="gf-ov-metric-label">Known Exploit</span>
        </div>
        <div className="gf-ov-metric" style={{
          borderTopColor: vuln.verified === 'confirmed' ? 'var(--critical)' :
                          vuln.verified === 'likely' ? 'var(--high)' : 'var(--text-muted)'
        }}>
          <span className="gf-ov-metric-val" style={{
            color: vuln.verified === 'confirmed' ? 'var(--critical)' :
                   vuln.verified === 'likely' ? 'var(--high)' : 'var(--text-muted)'
          }}>
            {vuln.verified === 'confirmed' ? 'Confirmed' :
             vuln.verified === 'likely' ? 'Likely' :
             vuln.verified === 'not_tested' ? 'N/A' : 'No'}
          </span>
          <span className="gf-ov-metric-label">Exploit Verified</span>
        </div>
      </div>
    </div>
  )
}
