import { useState } from 'react'
import type { RiskScore } from '../../api/types'
import VulnCard from './VulnCard'

interface VulnListProps {
  vulns: RiskScore[]
}

type SortKey = 'risk-desc' | 'risk-asc' | 'alpha'

export default function VulnList({ vulns }: VulnListProps) {
  const [sortBy, setSortBy] = useState<SortKey>('risk-desc')

  const sorted = [...vulns].sort((a, b) => {
    switch (sortBy) {
      case 'risk-desc':
        return b.risk_score - a.risk_score
      case 'risk-asc':
        return a.risk_score - b.risk_score
      case 'alpha':
        const aType = a.what?.vulnerability_type || a.vulnerability_id || ''
        const bType = b.what?.vulnerability_type || b.vulnerability_id || ''
        return aType.localeCompare(bType)
      default:
        return 0
    }
  })

  return (
    <div className="gf-vulnlist">
      <div className="gf-vulnlist-header">
        <span className="gf-vulnlist-count">
          {vulns.length} {vulns.length === 1 ? 'vulnerability' : 'vulnerabilities'}
        </span>
        <div className="gf-vulnlist-sort">
          <span className="gf-vulnlist-sort-label">Sort by</span>
          <select
            className="gf-select"
            value={sortBy}
            onChange={e => setSortBy(e.target.value as SortKey)}
          >
            <option value="risk-desc">Risk (High to Low)</option>
            <option value="risk-asc">Risk (Low to High)</option>
            <option value="alpha">Type (A-Z)</option>
          </select>
        </div>
      </div>

      {sorted.map((vuln, i) => (
        <VulnCard key={`${vuln.vulnerability_id || vuln.what?.vulnerability_type || 'vuln'}-${i}`} vuln={vuln} />
      ))}
    </div>
  )
}
